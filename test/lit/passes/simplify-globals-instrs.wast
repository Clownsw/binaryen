;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.
;; NOTE: This test was ported using port_passes_tests_to_lit.py and could be cleaned up.

;; RUN: foreach %s %t wasm-opt --simplify-globals --enable-extended-const -S -o - | filecheck %s

;; The globals will become immutable, and after doing so we can propagate the
;; value of the first into the second. The second's value then becomes constant
;; as well.
(module
  (memory 1)
  (table 1 funcref)

  ;; CHECK:      (global $A i32 (i32.const 40))
  (global $A (mut i32) (i32.const 40))

  ;; CHECK:      (global $B i32 (i32.const 42))
  (global $B (mut i32) (i32.add
    (global.get $A)
    (i32.const 2)
  ))

  (data (i32.sub
    (i32.const 100)
    (global.get $B)
  ) "foo")

  (elem (i32.add
    (global.get $B)
    (i32.const 0)
  ) (ref.null func))
)
