;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.
;; RUN: foreach %s %t wasm-opt --nominal --signature-refining -all -S -o - | filecheck %s

;; One function is dropped, while the the other is used. We can remove the
;; result from the dropped one.
(module
  (type $struct (struct_subtype (field i32) data))

  (type $sig (func_subtype (param anyref) func))

  (func $dropped (type $sig) (result anyref)
    (if
      (i32.const 1)
      (return
        (struct.new $struct
          (i32.const 1)
        )
      )
    )
    (struct.new $struct
      (i32.const 2)
    )
  )

  (func $used (type $sig) (result anyref)
    (if
      (i32.const 1)
      (return
        (struct.new $struct
          (i32.const 1)
        )
      )
    )
    (struct.new $struct
      (i32.const 2)
    )
  )

  (func $caller
    (local $temp (ref any))
    (drop
      (call $dropped)
    )
    (local.set $temp
      (call $used)
    )
  )
)
