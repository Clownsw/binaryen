;; NOTE: Assertions have been generated by update_lit_checks.py --all-items and should not be edited.
;; RUN: foreach %s %t wasm-opt -all --gufa            -S -o - | filecheck %s --check-prefix NO__OPT
;; RUN: foreach %s %t wasm-opt -all --gufa-optimizing -S -o - | filecheck %s --check-prefix YES_OPT

;; Compare the results of gufa and gufa-optimizing. The optimizing variant will
;; remove unneeded extra code that gufa might introduce, like dropped unneeded
;; things.

(module
  (import "a" "b" (func $import (result i32)))

  (func $foo (result i32)
    (i32.const 1)
  )

  (func $bar
    ;; Both arms of the select have identical values, 1. Inlining +
    ;; OptimizeInstructions could of course discover that in this case, but
    ;; GUFA can do so even without inlining. As a result the select will be
    ;; dropped (due to the call which may have effects, we keep it), and after
    ;; the select we emit the constant 1 for the value.
    (drop
      (select
        (call $foo)
        (i32.const 1)
        (call $import)
      )
    )
  )
)
